apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
# Our base Manifests
resources:
- ../../resources/namespace
- ../../resources/workload/deployment
- ../../resources/network/service

# These components are for the deploymnent and service.
# components are shared across each environment. There are no patches for the service and deployment here.
# Because the are the saem for evey environemnt each env will pull the patch from the components (DRY)
 

# The name suffix will be appended the name of the resources (bases). 
# In this example case our resource names are simply called `base`. 
# So our service and deployment names will end up being:
#  - 'base' + 'nameSuffix'
# This file as well as the ingress file will need to be aware of this name.
nameSuffix: -keycloak-1

#The namespace to run.
namespace: db

secretGenerator:
- name: keycloak-creds
  literals:
  - KC_DB=postgres
  - KC_DB_URL=base-postgres-1:5432
  - KC_DB_USERNAME=admin
  - KC_DB_PASSWORD=5H8MwbAGu7DvDng
  - KC_HOSTNAME=base-keycloak-1
  - KEYCLOAK_ADMIN=vgsadmin
  - KEYCLOAK_ADMIN_PASSWORD=fSHI3wpeR98GToh
  - KC_HEALTH_ENABLED=true

# The image and the tag to use.
images:
- name: UNDEFINED
  newName: vgs-keycloak
  newTag: 23.0.3

# Annotation Transformer - used to determine where to put annotations
transformers:
- ./transformers.yaml

# The common label used for lables and Selectors.
commonLabels:
  app.kubernetes.io/name: base-keycloak-1

# Replicas
replicas:
- name: base-keycloak-1
  count: 1

patches:
- path: ./patch/deployment.yaml
  target:
    kind: Deployment
    name: base
- path: ./patch/service.yaml
  target:
    kind: Service
    name: base